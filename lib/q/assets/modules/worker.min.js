function clone(n){var i,t;if(!n)return n;if(typeof n=="object"){i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}return n instanceof Array?n.splice(0):n}var isWorker=typeof importScripts=="function"&&!(typeof window!="undefined"&&window instanceof Window),Workers,swReg,ServiceWorker;(function(n){var t;(function(n){function f(n,i){return n?n.indexOf("__")===0&&n.lastIndexOf("__")===n.length-2?!1:i?(t[n]=i,!0):!1:!1}function e(n){return n.indexOf("__")===0&&n.lastIndexOf("__")===n.length-2?!1:t[n]}function o(n){return n?n.indexOf("__")===0&&n.lastIndexOf("__")===n.length-2?!1:delete t[n]:!1}function i(n,t,i,r){try{return n&&n.apply(r,i)}catch(u){return(i=i.slice()).unshift(u),t&&t.apply(r,i)}}var t={},s,r,u;n.registerHandler=f;n.getHandler=e;n.unregisterHandler=o;s=!1;r=function(){function n(){this.onPostMessageError=function(n,t){this.postMessage({Id:t.Id,IsError:!0,Data:"UnExpectedError",keepAlive:!1})}.bind(this);this.Start()}return n.prototype.Start=function(){this._worker=self;this._worker.addEventListener("error",this._onerror.bind(this),{capture:!0});this._worker.addEventListener("message",this._onmessage.bind(this),{capture:!0})},n.prototype._onerror=function(){},n.prototype._onmessage=function(n){var u=n.data,f=t[u.Handler],r={e:n,Msg:u,Result:undefined,Handled:!1,Thread:this},e=i(f,this._onHandlerError,[r],this);r.Handled||this.postMessage({Id:u.Id,Data:r.Result||e,keepAlive:r.keepAlive},n.origin,n.ports,n.ports.slice())},n.prototype._onHandlerError=function(n,t){t.Error=!0;t.Handled=!0;this.postMessage({Id:t.Msg.Id,IsError:!0,Data:n,keepAlive:!1})},n.prototype.postMessage=function(n,t,r,u){var e,f;if(u&&u.length!=0)for(e=[n],f=0;f<u.length;f++)i(u[f].postMessage,this.onPostMessageError,e,u[f]);else e=isWorker?[n,r]:[n,t?t:void 0,r],i(this._worker.postMessage,this.onPostMessageError,e,this._worker)},n.Start=function(){this.Default=new n},n}();n.Server=r;u=function(){function n(n){this._url=n;this._quee={};this.Start()}return n.prototype.Start=function(){this._worker=new Worker(this._url);this._worker.addEventListener("error",this._onerror.bind(this),{capture:!0});this._worker.addEventListener("message",this._onmessage.bind(this),{capture:!0})},n.prototype.Send=function(n){var t=performance.now();n.Id=t;this._quee[t]=n;this._worker.postMessage({Id:t,Data:n.data,Handler:n.handler})},n.prototype._onmessage=function(n){var t=n.data,r=this._quee[t.Id];r&&(i(r.callback,undefined,[r,t],r),t.keepAlive||delete this._quee[t.Id])},n.prototype._onerror=function(){},n.counter=0,n}();n.Client=u,function(){function n(n,i){t[n]=i}n("getValue",function(n){return self[n.Msg.Data]});n("__close__",function(){return isWorker&&self.close(),isWorker});n("__loadScripts__",function(n){importScripts(n.Msg.Data)});n("__hasHandler__",function(n){return t[n.Msg.Handler]instanceof Function});n("__href__",function(){return location.href});n("__getHandlers__",function(){return Object.keys(t)})}()})(t=n.WebWorker||(n.WebWorker={}))})(Workers||(Workers={}));ServiceWorker=function(){function n(){}return n.Start=function(n,t){return navigator.serviceWorker.register(n,t?{scope:t}:void 0).then(function(n){swReg=clone(swReg);console.log("SW registration succeeded. Scope is "+n.scope)}).catch(function(n){console.error("SW registration failed with error "+n)})},n.postMessageToSW=function(n){return new Promise(function(t,i){navigator.serviceWorker.getRegistration().then(function(r){var u=new MessageChannel;r.active.postMessage(n,[u.port2]);u.port1.onmessage=function(r){var u=r.data;(u.IsError?i:t)(u.IsError?{IsError:!0,Action:n,Result:u}:{Action:n,Result:u})}}).catch(function(t){i({IsError:!0,Action:n,Result:t})})})},n}();